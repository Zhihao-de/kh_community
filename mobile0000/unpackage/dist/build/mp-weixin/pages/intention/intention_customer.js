(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/intention/intention_customer"],{4058:function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(e("a34a"));function i(n){return n&&n.__esModule?n:{default:n}}function a(n,t,e,o,i,a,r){try{var c=n[a](r),u=c.value}catch(s){return void e(s)}c.done?t(u):Promise.resolve(u).then(o,i)}function r(n){return function(){var t=this,e=arguments;return new Promise((function(o,i){var r=n.apply(t,e);function c(n){a(r,o,i,c,u,"next",n)}function u(n){a(r,o,i,c,u,"throw",n)}c(void 0)}))}}var c=function(){e.e("components/uni-load-more/uni-load-more").then(function(){return resolve(e("0e49"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("components/empty").then(function(){return resolve(e("3004"))}.bind(null,e)).catch(e.oe)},s={components:{uniLoadMore:c,empty:u},data:function(){return{tabCurrentIndex:0,allIntentions:[],navList:[{flags:8,page:1,text:"全部",loadingType:"more",intentionList:[]},{flags:0,page:1,text:"未分配",loadingType:"more",intentionList:[]},{flags:1,page:1,text:"已分配",loadingType:"more",intentionList:[]},{flags:2,page:1,text:"已完成",loadingType:"more",intentionList:[]},{flags:3,page:1,text:"已取消",loadingType:"more",intentionList:[]}]}},onLoad:function(n){this.tabCurrentIndex=0,8===n.flags&&this.loadData()},methods:{loadData:function(n){var t=this;return r(o.default.mark((function e(){var i,a,r,c,u,s,f;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.tabCurrentIndex,a=t.navList[i],r=a.flags,"tabChange"!==n||!0!==a.loaded){e.next=5;break}return e.abrupt("return");case 5:if("loading"!==a.loadingType){e.next=7;break}return e.abrupt("return");case 7:return a.loadingType="loading",e.next=10,t.getIntentions();case 10:c=e.sent,console.log(c),u=[],f=0;case 14:if(!(f<c.length)){e.next=22;break}return e.next=17,t.getIntentionDetails(c[f].id);case 17:s=e.sent,u.push({info:c[f],detail:s});case 19:f++,e.next=14;break;case 22:console.log(u),setTimeout((function(){console.log(u);var n=u.filter((function(n){return n=Object.assign(n,t.intentionflagsExp(n.info.flags)),8===r?n:n.info.flags===r}));n.forEach((function(n){a.intentionList.push(n)})),t.$set(a,"loaded",!0),a.loadingType="noMore"}),600);case 24:case"end":return e.stop()}}),e)})))()},changeTab:function(n){this.tabCurrentIndex=n.target.current,this.loadData("tabChange")},tabClick:function(n){this.tabCurrentIndex=n},deleteIntention:function(t){var e=this;n.showLoading({title:"请稍后"}),setTimeout((function(){e.navList[e.tabCurrentIndex].intentionList.splice(t,1),n.hideLoading()}),600)},cancelIntention:function(t){var e=this;new Promise((function(o){n.request({header:{"content-type":"application/JSON"},url:e.api.ApiRoot+"intentions/"+t.info.id+"/",data:{id:t.info.id,serial_number:t.info.serial_number,flags:3,name:t.info.name,phone:t.info.phone,country:t.info.country,province:t.info.province,city:t.info.city,address:t.info.address,postcode:t.info.postcode,message:t.info.message,quantity:t.info.quantity,wx_open_id:t.info.wx_open_id,wx_union_id:t.info.wx_union_id,wx_name:t.info.wx_name,wx_avatar_url:t.info.wx_avatar_url},method:"PUT",success:function(t){console.log(t.data),n.showModal({title:"提示",content:"取消成功！"})},fail:function(n){console.log(n)}})})).catch((function(n){}))},finishIntention:function(t){var e=this;new Promise((function(o){n.request({header:{"content-type":"application/JSON"},url:e.api.ApiRoot+"intentions/"+t.info.id+"/",data:{id:t.info.id,serial_number:t.info.serial_number,flags:3,name:t.info.name,phone:t.info.phone,country:t.info.country,province:t.info.province,city:t.info.city,address:t.info.address,postcode:t.info.postcode,message:t.info.message,quantity:t.info.quantity,wx_open_id:t.info.wx_open_id,wx_union_id:t.info.wx_union_id,wx_name:t.info.wx_name,wx_avatar_url:t.info.wx_avatar_url},method:"PUT",success:function(t){console.log(t.data),n.showModal({title:"提示",content:"留言订单已完成！"})},fail:function(n){console.log(n)}})})).catch((function(n){}))},getIntentions:function(){var t=this;return new Promise((function(e){n.request({header:{"content-type":"application/x-www-form-urlencoded"},url:t.api.ApiRoot+"intentions/",data:{wxid:n.getStorageSync("userDetail").wx_open_id},method:"GET",success:function(n){e(n.data)},fail:function(n){console.log(n)}})})).catch((function(n){}))},getIntentionDetails:function(t){var e=this;return new Promise((function(o){n.request({header:{"content-type":"application/x-www-form-urlencoded"},url:e.api.ApiRoot+"intentions/"+t+"/details",method:"GET",success:function(n){o(n.data)},fail:function(n){console.log(n)}})})).catch((function(n){}))},intentionflagsExp:function(n){var t="",e="#fa436a";switch(+n){case 0:t="未分配",e="#fa6c1d";break;case 1:t="已分配",e="#5efa54";break;case 2:t="已完成",e="#8c62fa";break;case 3:t="已取消",e="#000000";break;case 9:t="订单已关闭",e="#909399",e="#f4faf9";break}return{flagsTip:t,flagsTipColor:e}},navToDetailPage:function(t){var e=t;n.navigateTo({url:"/pages/intention/intentionDetail_customer?data=".concat(encodeURIComponent(JSON.stringify(e)))})}}};t.default=s}).call(this,e("543d")["default"])},"62d7":function(n,t,e){"use strict";e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){return o}));var o={uniLoadMore:function(){return e.e("components/uni-load-more/uni-load-more").then(e.bind(null,"0e49"))}},i=function(){var n=this,t=n.$createElement;n._self._c},a=[]},"7a69":function(n,t,e){},"85df":function(n,t,e){"use strict";e.r(t);var o=e("62d7"),i=e("c0a1");for(var a in i)"default"!==a&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("eaca");var r,c=e("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=u.exports},"87a4":function(n,t,e){"use strict";(function(n){e("351e"),e("921b");o(e("66fd"));var t=o(e("85df"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},c0a1:function(n,t,e){"use strict";e.r(t);var o=e("4058"),i=e.n(o);for(var a in o)"default"!==a&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},eaca:function(n,t,e){"use strict";var o=e("7a69"),i=e.n(o);i.a}},[["87a4","common/runtime","common/vendor"]]]);